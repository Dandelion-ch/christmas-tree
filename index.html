<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>â„ï¸ è¶…æµªæ¼«åœ£è¯æ ‘ä»£ç  â„ï¸</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        .header {
            text-align: center;
            margin-bottom: 25px;
            width: 100%;
        }
        .title {
            color: #4CAF50;
            font-size: 28px;
            margin-bottom: 10px;
            text-shadow: 0 0 15px #4CAF50;
        }
        .subtitle {
            color: #FFD700;
            font-size: 16px;
            opacity: 0.8;
        }
        .tree-box {
            background: rgba(0, 30, 0, 0.3);
            border: 2px solid rgba(0, 255, 0, 0.2);
            border-radius: 20px;
            padding: 30px 20px;
            margin: 20px auto;
            max-width: 100%;
            overflow: hidden;
            position: relative;
            box-shadow: 0 0 40px rgba(0, 255, 100, 0.2);
        }
        .tree {
            font-size: 22px;
            line-height: 1.3;
            text-align: center;
            color: #32CD32;
            text-shadow: 0 0 10px #32CD32;
            white-space: pre;
            margin: 0 auto;
        }
        .light {
            display: inline-block;
            animation: sparkle 0.8s infinite alternate;
        }
        @keyframes sparkle {
            0% { opacity: 0.4; transform: scale(0.95); }
            100% { opacity: 1; transform: scale(1.1); }
        }
        .wish-panel {
            background: rgba(255, 215, 0, 0.15);
            border-radius: 15px;
            padding: 25px 20px;
            margin: 30px auto;
            width: 90%;
            max-width: 500px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            position: relative;
        }
        .wish-panel::before {
            content: 'â€œ';
            font-size: 60px;
            color: gold;
            position: absolute;
            left: 15px;
            top: 10px;
            opacity: 0.5;
        }
        .wish {
            font-size: 22px;
            color: #FFD700;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 0 20px;
            line-height: 1.4;
        }
        .author {
            color: #aaa;
            text-align: right;
            font-style: italic;
            margin-top: 15px;
            padding-right: 20px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
            width: 100%;
        }
        .control-btn {
            background: rgba(255, 87, 34, 0.2);
            color: #FF5722;
            border: 2px solid #FF5722;
            padding: 14px 25px;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 160px;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        .control-btn:hover {
            background: rgba(255, 87, 34, 0.4);
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(255, 87, 34, 0.4);
        }
        .control-btn:active {
            transform: translateY(0);
        }
        .share-btn {
            background: rgba(33, 150, 243, 0.2);
            color: #2196F3;
            border-color: #2196F3;
        }
        .share-btn:hover {
            background: rgba(33, 150, 243, 0.4);
            box-shadow: 0 5px 20px rgba(33, 150, 243, 0.4);
        }
        .footer {
            margin-top: 30px;
            color: #666;
            text-align: center;
            font-size: 14px;
            width: 100%;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .footer p {
            margin: 8px 0;
        }
        .stats {
            display: inline-block;
            padding: 8px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            margin: 15px;
            font-size: 14px;
            color: #88aaff;
        }
        /* é›ªèŠ±ç‰¹æ•ˆ */
        .snowflake {
            position: absolute;
            color: #a0e0ff;
            font-size: 24px;
            user-select: none;
            pointer-events: none;
            z-index: -1;
            animation: snowfall linear infinite;
            opacity: 0.7;
        }
        @keyframes snowfall {
            0% { transform: translateY(-10%) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
        }
        /* çˆ±å¿ƒç‰¹æ•ˆ */
        .heart {
            position: absolute;
            color: #ff2a6d;
            font-size: 28px;
            pointer-events: none;
            z-index: 10;
            animation: heartFloat 2s ease-out forwards;
        }
        @keyframes heartFloat {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-100px) scale(1.5); }
        }
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .tree { font-size: 18px; }
            .wish { font-size: 19px; }
            .control-btn { min-width: 140px; padding: 12px 20px; }
            .title { font-size: 24px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="title">ğŸ„ è¶…æµªæ¼«åœ£è¯æ ‘ä»£ç  ğŸ„</h1>
        <p class="subtitle">ä»£ç æµªæ¼« Â· å¾®ä¿¡ä»£ç æµªæ¼« Â· ä¸“å±ç¨‹åºå‘˜çš„æµªæ¼«</p>
        <div class="stats">âœ¨ ä¼ é€’æ¬¡æ•°: <span id="visitCount">1</span></div>
    </div>
    
    <div class="tree-box">
        <div class="tree" id="treeDisplay"></div>
    </div>
    
    <div class="wish-panel">
        <div class="wish" id="wishText">æ„¿ä½ è¢«è¿™ä¸ªä¸–ç•Œæ¸©æŸ”ä»¥å¾…</div>
        <div class="author" id="wishAuthor">â€”â€” æ¸©æš–çš„ç¥ç¦</div>
    </div>
    
    <div class="controls">
        <button class="control-btn" onclick="changeLightsMode()">
            <span>ğŸ’¡</span> åˆ‡æ¢ç¯å…‰æ¨¡å¼
        </button>
        <button class="control-btn" onclick="changeWish()">
            <span>ğŸ”</span> éšæœºç¥ç¦
        </button>
        <button class="control-btn" onclick="addSnow()">
            <span>â„ï¸</span> å†°é›ªç‰¹æ•ˆ
        </button>
        <button class="control-btn" onclick="sendHearts()">
            <span>â¤ï¸</span> å‘å°„çˆ±å¿ƒ
        </button>
        <button class="control-btn share-btn" onclick="shareCode()">
            <span>ğŸ“²</span> åˆ†äº«ä»£ç 
        </button>
    </div>
    
    <div class="footer">
        <p>@è”æç”œç”œ åŒæ¬¾ | æŠ–éŸ³çˆ†æ¬¾åœ£è¯æ ‘ä»£ç </p>
        <p>å¤åˆ¶æ•´æ®µä»£ç ï¼Œåœ¨å¾®ä¿¡ä¸­å‘é€ç»™TA</p>
        <p>æˆ–ä¿å­˜æ­¤é“¾æ¥åˆ†äº«æµªæ¼«: <span id="pageUrl">æ­£åœ¨åŠ è½½...</span></p>
        <p style="color: #4CAF50; margin-top: 15px;">ğŸ… åœ£è¯å¿«ä¹ï¼æ„¿çˆ±å’Œæ¸©æš–ä¸ä½ åŒåœ¨</p>
    </div>

    <script>
        // ====== æ ¸å¿ƒæ•°æ® ======
        const TREE_LAYERS = [
            "         â˜†",
            "        âœ¨âœ¨âœ¨",
            "       âœ¨âœ¨âœ¨âœ¨âœ¨",
            "      âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨",
            "     âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨",
            "    âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨",
            "   âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨",
            "  âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨",
            " âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨",
            "        â–ˆâ–ˆâ–ˆ",
            "        â–ˆâ–ˆâ–ˆ"
        ];
        
        const BLESSINGS = [
            {text: "æ„¿ä½ çš„ä»£ç æ°¸è¿œæ²¡æœ‰BUG", author: "ç¨‹åºå‘˜å®ˆæŠ¤ç¥"},
            {text: "å¹³å®‰å–œä¹ï¼Œå¾—å¿æ‰€æ„¿", author: "å¹³å®‰å¤œç²¾çµ"},
            {text: "çˆ±ä½ æ‰€çˆ±ï¼Œè¡Œä½ æ‰€è¡Œ", author: "åˆå¿ƒä½¿è€…"},
            {text: "æ‰€æœ‰ç¾å¥½ï¼Œå¦‚æœŸè€Œè‡³", author: "æ—¶å…‰è¯—äºº"},
            {text: "æ„¿æ˜Ÿå…‰ä¸è´Ÿèµ¶è·¯äºº", author: "æ˜Ÿç©ºå®ˆæœ›è€…"},
            {text: "æ¸©æš–ç›¸ä¼´ï¼Œå²å²å¹´å¹´", author: "æ¸©æš–ä¼ é€’è€…"},
            {text: "å¿ƒä¸­æœ‰å…‰ï¼Œè„šä¸‹æœ‰è·¯", author: "å…‰æ˜å¼•è·¯äºº"}
        ];
        
        const LIGHT_MODES = [
            {name: "å•è‰²é—ªçƒ", colors: ['#FF0000']},
            {name: "çº¢ç»¿äº¤æ›¿", colors: ['#FF0000', '#00FF00']},
            {name: "å½©è™¹æ¸å˜", colors: ['#FF0000', '#FFA500', '#FFFF00', '#00FF00', '#00FFFF', '#0000FF', '#8B00FF']},
            {name: "æš–è‰²æ¸©é¦¨", colors: ['#FFD700', '#FFA500', '#FF69B4', '#FF1493']}
        ];
        
        // ====== çŠ¶æ€ç®¡ç† ======
        let state = {
            visitCount: parseInt(localStorage.getItem('romanticXmasCount')) || 1,
            currentLightMode: 0,
            currentBlessing: 0,
            lightIndex: 0,
            snowActive: false,
            snowflakes: []
        };
        
        // ====== åˆå§‹åŒ– ======
        function init() {
            // æ›´æ–°è®¿é—®æ•°æ®
            state.visitCount++;
            localStorage.setItem('romanticXmasCount', state.visitCount);
            document.getElementById('visitCount').textContent = state.visitCount;
            
            // æ˜¾ç¤ºå½“å‰é¡µé¢URL
            document.getElementById('pageUrl').textContent = window.location.href;
            
            // ç»˜åˆ¶åˆå§‹æ ‘
            drawTree();
            
            // è®¾ç½®åˆå§‹ç¥ç¦
            updateBlessing();
            
            // è‡ªåŠ¨ç¯å…‰åˆ‡æ¢
            setInterval(() => {
                state.lightIndex = (state.lightIndex + 1) % LIGHT_MODES[state.currentLightMode].colors.length;
                drawTree();
            }, 600);
            
            // è‡ªåŠ¨ç¥ç¦åˆ‡æ¢ï¼ˆæ¯7ç§’ï¼‰
            setInterval(() => {
                state.currentBlessing = (state.currentBlessing + 1) % BLESSINGS.length;
                updateBlessing();
            }, 7000);
            
            // æ§åˆ¶å°æ¬¢è¿
            console.log('%cğŸ„ è¶…æµªæ¼«åœ£è¯æ ‘ä»£ç å·²åŠ è½½ï¼', 'color: #4CAF50; font-size: 16px;');
            console.log('%câ¤ï¸ åˆ†äº«è¿™ä»½æµªæ¼«ç»™ä½ çš„TAå§~', 'color: #FF69B4;');
        }
        
        // ====== ç»˜åˆ¶åœ£è¯æ ‘ ======
        function drawTree() {
            const colors = LIGHT_MODES[state.currentLightMode].colors;
            const currentColor = colors[state.lightIndex % colors.length];
            
            let treeHTML = '';
            TREE_LAYERS.forEach(layer => {
                let lineHTML = '';
                for (let char of layer) {
                    if (char === 'âœ¨') {
                        const animationDelay = (Math.random() * 0.5).toFixed(2);
                        lineHTML += `<span class="light" style="color:${currentColor}; animation-delay:${animationDelay}s">${char}</span>`;
                    } else if (char === 'â˜†') {
                        lineHTML += `<span style="color:gold; text-shadow:0 0 10px gold">${char}</span>`;
                    } else if (char === 'â–ˆ') {
                        lineHTML += `<span style="color:#8B4513">${char}</span>`;
                    } else {
                        lineHTML += char;
                    }
                }
                treeHTML += lineHTML + '\n';
            });
            
            document.getElementById('treeDisplay').innerHTML = treeHTML;
        }
        
        // ====== æ›´æ–°ç¥ç¦ ======
        function updateBlessing() {
            const blessing = BLESSINGS[state.currentBlessing];
            const wishText = document.getElementById('wishText');
            const wishAuthor = document.getElementById('wishAuthor');
            
            // æ·¡å‡ºæ•ˆæœ
            wishText.style.opacity = 0;
            wishAuthor.style.opacity = 0;
            
            setTimeout(() => {
                wishText.textContent = blessing.text;
                wishAuthor.textContent = `â€”â€” ${blessing.author}`;
                
                // æ·¡å…¥æ•ˆæœ
                wishText.style.transition = 'opacity 0.8s ease';
                wishAuthor.style.transition = 'opacity 0.8s ease';
                wishText.style.opacity = 1;
                wishAuthor.style.opacity = 1;
            }, 300);
        }
        
        // ====== äº¤äº’åŠŸèƒ½ ======
        function changeLightsMode() {
            state.currentLightMode = (state.currentLightMode + 1) % LIGHT_MODES.length;
            state.lightIndex = 0;
            drawTree();
            
            // æ›´æ–°æŒ‰é’®æç¤º
            const modeName = LIGHT_MODES[state.currentLightMode].name;
            document.querySelector('button[onclick="changeLightsMode()"] span').textContent = 
                modeName === 'å½©è™¹æ¸å˜' ? 'ğŸŒˆ' : 'ğŸ’¡';
        }
        
        function changeWish() {
            state.currentBlessing = (state.currentBlessing + 1) % BLESSINGS.length;
            updateBlessing();
        }
        
        function addSnow() {
            state.snowActive = !state.snowActive;
            
            if (state.snowActive) {
                createSnowfall();
                document.querySelector('button[onclick="addSnow()"] span').textContent = 'â˜€ï¸';
            } else {
                removeSnowflakes();
                document.querySelector('button[onclick="addSnow()"] span').textContent = 'â„ï¸';
            }
        }
        
        function createSnowfall() {
            const snowCount = 40;
            
            for (let i = 0; i < snowCount; i++) {
                setTimeout(() => createSnowflake(), i * 100);
            }
            
            // æŒç»­ç”Ÿæˆ
            const interval = setInterval(() => {
                if (state.snowActive) {
                    createSnowflake();
                } else {
                    clearInterval(interval);
                }
            }, 500);
        }
        
        function createSnowflake() {
            const snowflake = document.createElement('div');
            snowflake.className = 'snowflake';
            snowflake.innerHTML = ['â„ï¸', 'â…', 'â†'][Math.floor(Math.random() * 3)];
            
            // éšæœºå±æ€§
            const size = 18 + Math.random() * 25;
            const left = Math.random() * 100;
            const duration = 6 + Math.random() * 8;
            const delay = Math.random() * 3;
            
            snowflake.style.fontSize = `${size}px`;
            snowflake.style.left = `${left}vw`;
            snowflake.style.animationDuration = `${duration}s`;
            snowflake.style.animationDelay = `${delay}s`;
            
            document.body.appendChild(snowflake);
            state.snowflakes.push(snowflake);
            
            // è‡ªåŠ¨æ¸…ç†
            setTimeout(() => {
                if (snowflake.parentNode) {
                    snowflake.parentNode.removeChild(snowflake);
                    state.snowflakes = state.snowflakes.filter(s => s !== snowflake);
                }
            }, (duration + 5) * 1000);
        }
        
        function removeSnowflakes() {
            state.snowflakes.forEach(snowflake => {
                if (snowflake.parentNode) {
                    snowflake.parentNode.removeChild(snowflake);
                }
            });
            state.snowflakes = [];
        }
        
        function sendHearts() {
            const heartCount = 12;
            
            for (let i = 0; i < heartCount; i++) {
                setTimeout(() => createHeart(), i * 150);
            }
        }
        
        function createHeart() {
            const heart = document.createElement('div');
            heart.className = 'heart';
            heart.innerHTML = 'â¤ï¸';
            
            // éšæœºèµ·å§‹ä½ç½®
            const startLeft = 30 + Math.random() * 40;
            
            heart.style.left = `${startLeft}%`;
            heart.style.bottom = '20%';
            heart.style.fontSize = `${22 + Math.random() * 20}px`;
            heart.style.animationDuration = `${1.5 + Math.random()}s`;
            
            document.body.appendChild(heart);
            
            // è‡ªåŠ¨æ¸…ç†
            setTimeout(() => {
                if (heart.parentNode) {
                    heart.parentNode.removeChild(heart);
                }
            }, 2500);
        }
        
        function shareCode() {
            const pageUrl = window.location.href;
            const shareText = `ğŸ„ æˆ‘æ”¶åˆ°äº†è¿™ä»½è¶…æµªæ¼«çš„åœ£è¯æ ‘ä»£ç ï¼\n\nâœ¨ åŠ¨æ€é—ªçƒç¯å…‰\nâœ¨ æ¸©é¦¨ç¥ç¦è¯­\nâœ¨ é›ªèŠ±çˆ±å¿ƒç‰¹æ•ˆ\n\nç‚¹å‡»æŸ¥çœ‹ï¼š${pageUrl}\n\n#åœ£è¯æ ‘ä»£ç  #ç¨‹åºå‘˜æµªæ¼« #æŠ–éŸ³åŒæ¬¾`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'è¶…æµªæ¼«åœ£è¯æ ‘ä»£ç ',
                    text: shareText,
                    url: pageUrl
                }).catch(err => console.log('åˆ†äº«å–æ¶ˆ:', err));
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('âœ¨ åˆ†äº«æ–‡æ¡ˆå·²å¤åˆ¶ï¼\n\nå¯ä»¥ç²˜è´´åˆ°å¾®ä¿¡ã€QQç­‰Appåˆ†äº«ç»™ä½ çš„TA~');
                }).catch(err => {
                    prompt('è¯·å¤åˆ¶ä»¥ä¸‹é“¾æ¥åˆ†äº«ï¼š', pageUrl);
                });
            }
        }
        
        // ====== é¡µé¢åŠ è½½ ======
        window.addEventListener('load', init);
        
        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            switch(e.key.toLowerCase()) {
                case 'l': changeLightsMode(); break;
                case 'w': changeWish(); break;
                case 's': addSnow(); break;
                case 'h': sendHearts(); break;
                case ' ': shareCode(); break;
            }
        });
    </script>
</body>
</html>
