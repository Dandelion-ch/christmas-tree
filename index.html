<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ¨ ç»ˆæåŠ¨æ€ç‚«å…‰åœ£è¯æ ‘ âœ¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=ZCOOL+QingKe+HuangYou&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-green: #00ff88;
            --sparkle-gold: #ffdd00;
            --heart-red: #ff2a6d;
            --snow-blue: #d1f7ff;
            --bg-deep: #0a0a2a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, var(--bg-deep) 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* èƒŒæ™¯æ˜Ÿå…‰ */
        #stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle var(--duration) infinite ease-in-out;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 30px 20px;
            text-align: center;
            position: relative;
            z-index: 10;
        }

        /* æ ‡é¢˜åŒºåŸŸ */
        .header {
            margin-bottom: 40px;
            position: relative;
        }

        .title-glow {
            font-family: 'ZCOOL QingKe HuangYou', cursive;
            font-size: 3.2rem;
            background: linear-gradient(45deg, var(--primary-green), var(--sparkle-gold), #00ccff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 15px;
            text-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            from { filter: hue-rotate(0deg); }
            to { filter: hue-rotate(360deg); }
        }

        .subtitle {
            font-size: 1.2rem;
            color: #a0e7ff;
            opacity: 0.9;
            margin-bottom: 25px;
        }

        /* æ•°æ®é¢æ¿ */
        .stats-panel {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .stat-item {
            text-align: center;
            min-width: 120px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--sparkle-gold);
            text-shadow: 0 0 15px currentColor;
            line-height: 1;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* åœ£è¯æ ‘å®¹å™¨ - æ ¸å¿ƒåŒºåŸŸ */
        .tree-section {
            position: relative;
            margin: 50px auto;
            padding: 40px 30px;
            background: rgba(10, 20, 40, 0.6);
            border-radius: 25px;
            border: 2px solid transparent;
            background-clip: padding-box;
            box-shadow: 
                inset 0 0 30px rgba(0, 100, 255, 0.2),
                0 15px 40px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            min-height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tree-section::before {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(45deg, 
                var(--primary-green), 
                var(--sparkle-gold), 
                #ff00ff, 
                #00ccff);
            border-radius: inherit;
            z-index: -1;
            animation: borderRotate 4s linear infinite;
        }

        @keyframes borderRotate {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }

        /* æ ‘ä½“æ ·å¼ */
        #treeCanvas {
            max-width: 100%;
            height: auto;
            filter: drop-shadow(0 0 20px rgba(0, 255, 136, 0.3));
        }

        /* ç¥ç¦è¯­åŒºåŸŸ */
        .wish-box {
            background: linear-gradient(135deg, 
                rgba(255, 42, 109, 0.15) 0%, 
                rgba(0, 204, 255, 0.15) 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 40px auto;
            max-width: 700px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .wish-box::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 4px;
            background: linear-gradient(90deg, 
                var(--primary-green), 
                var(--sparkle-gold), 
                var(--heart-red));
        }

        .wish-text {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 2.2rem;
            color: #fff;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            margin-bottom: 15px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 2;
        }

        .wish-author {
            font-size: 1.1rem;
            color: var(--sparkle-gold);
            font-style: italic;
            opacity: 0.9;
        }

        /* æ§åˆ¶æŒ‰é’®ç»„ */
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            max-width: 800px;
            margin: 40px auto;
        }

        .ctrl-btn {
            background: rgba(255, 255, 255, 0.08);
            border: none;
            border-radius: 15px;
            padding: 20px 15px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .ctrl-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .ctrl-btn:active {
            transform: translateY(-2px);
        }

        .ctrl-btn i {
            font-size: 2rem;
            transition: transform 0.3s;
        }

        .ctrl-btn:hover i {
            transform: scale(1.2);
        }

        .btn-label {
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        /* ç‰¹æ•ˆæŒ‰é’®é¢œè‰² */
        .btn-light { color: var(--primary-green); }
        .btn-style { color: #ff9966; }
        .btn-wish { color: #9966ff; }
        .btn-snow { color: var(--snow-blue); }
        .btn-heart { color: var(--heart-red); }
        .btn-music { color: #ffcc00; }
        .btn-share { color: #00ccff; }

        /* é¡µè„š */
        .footer {
            margin-top: 60px;
            color: #88aaff;
            font-size: 0.95rem;
            opacity: 0.8;
            padding: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* ç²’å­ç‰¹æ•ˆå±‚ */
        #particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }

        /* é›ªèŠ± */
        .snowflake {
            position: absolute;
            color: var(--snow-blue);
            font-size: 20px;
            user-select: none;
            pointer-events: none;
            animation: snowFall linear infinite;
            opacity: 0.7;
        }

        @keyframes snowFall {
            0% {
                transform: translateY(-10%) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(110vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* çˆ±å¿ƒ */
        .heart {
            position: absolute;
            color: var(--heart-red);
            font-size: 24px;
            pointer-events: none;
            z-index: 20;
            animation: heartFloat 2s ease-out forwards;
            filter: drop-shadow(0 0 5px currentColor);
        }

        @keyframes heartFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-150px) scale(1.5);
            }
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .title-glow { font-size: 2.5rem; }
            .stats-panel { padding: 20px 15px; gap: 20px; }
            .stat-value { font-size: 2rem; }
            .wish-text { font-size: 1.8rem; }
            .controls-grid { grid-template-columns: repeat(2, 1fr); }
            .tree-section { padding: 30px 15px; min-height: 400px; }
        }

        @media (max-width: 480px) {
            .title-glow { font-size: 2rem; }
            .controls-grid { grid-template-columns: 1fr; }
            .stat-item { min-width: 100px; }
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯æ˜Ÿå…‰ -->
    <div id="stars"></div>
    
    <!-- ç²’å­ç‰¹æ•ˆå±‚ -->
    <div id="particles"></div>

    <div class="container">
        <!-- æ ‡é¢˜åŒº -->
        <header class="header">
            <h1 class="title-glow">âœ¨ ç»ˆæåŠ¨æ€ç‚«å…‰åœ£è¯æ ‘ âœ¨</h1>
            <p class="subtitle">æ¯ä¸€æ¬¡é—ªçƒï¼Œéƒ½æ˜¯å¯¹ä½ çš„ç¥ç¦ | æ¯ä¸€æ¬¡äº’åŠ¨ï¼Œéƒ½æœ‰æƒŠå–œå‘ç”Ÿ</p>
        </header>

        <!-- æ•°æ®é¢æ¿ -->
        <section class="stats-panel">
            <div class="stat-item">
                <div class="stat-value" id="visitCount">1</div>
                <div class="stat-label">è®¿é—®æ¬¡æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="lightCount">128</div>
                <div class="stat-label">ç¯å…‰é—ªçƒ</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="wishCount">1</div>
                <div class="stat-label">ç¥ç¦é€è¾¾</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="heartCount">0</div>
                <div class="stat-label">çˆ±å¿ƒå‘å°„</div>
            </div>
        </section>

        <!-- åœ£è¯æ ‘æ ¸å¿ƒå±•ç¤ºåŒº -->
        <section class="tree-section">
            <canvas id="treeCanvas" width="600" height="500"></canvas>
        </section>

        <!-- ç¥ç¦è¯­åŒº -->
        <section class="wish-box">
            <div class="wish-text" id="wishText">æ„¿ä½ å¿ƒæƒ³äº‹æˆï¼Œç¾æ¢¦æˆçœŸ</div>
            <div class="wish-author" id="wishAuthor">â€”â€” å°ç²¾çµ</div>
        </section>

        <!-- æ§åˆ¶æŒ‰é’®ç»„ -->
        <div class="controls-grid">
            <button class="ctrl-btn btn-light" onclick="toggleLights()">
                <i class="fas fa-lightbulb"></i>
                <span class="btn-label">æ¢¦å¹»ç¯å…‰</span>
            </button>
            <button class="ctrl-btn btn-style" onclick="changeTreeStyle()">
                <i class="fas fa-palette"></i>
                <span class="btn-label">åˆ‡æ¢æ ·å¼</span>
            </button>
            <button class="ctrl-btn btn-wish" onclick="changeWish()">
                <i class="fas fa-comment-alt"></i>
                <span class="btn-label">æ›´æ¢ç¥ç¦</span>
            </button>
            <button class="ctrl-btn btn-snow" onclick="toggleSnow()">
                <i class="fas fa-snowflake"></i>
                <span class="btn-label">å†°é›ªä¸–ç•Œ</span>
            </button>
            <button class="ctrl-btn btn-heart" onclick="launchHearts()">
                <i class="fas fa-heart"></i>
                <span class="btn-label">å‘å°„çˆ±å¿ƒ</span>
            </button>
            <button class="ctrl-btn btn-music" onclick="toggleMusic()">
                <i class="fas fa-music"></i>
                <span class="btn-label">èŠ‚æ—¥éŸ³ä¹</span>
            </button>
            <button class="ctrl-btn btn-share" onclick="shareTree()">
                <i class="fas fa-share-alt"></i>
                <span class="btn-label">åˆ†äº«å–œæ‚¦</span>
            </button>
        </div>

        <!-- é¡µè„š -->
        <footer class="footer">
            <p>ğŸ„ è¿™ä»½æµªæ¼«ï¼Œä¸“å±äºçœ‹åˆ°å®ƒçš„ä½  | ğŸ… åœ£è¯å¿«ä¹ï¼Œä¸æ­¢ä»Šå¤©</p>
            <p>â¤ï¸ ç”¨ä»£ç ç¼–ç»‡æ¸©æš–ï¼Œè®©æŠ€æœ¯ä¼ é€’ç¥ç¦ | åˆ·æ–°é¡µé¢ä¼šæœ‰æ–°æƒŠå–œ</p>
        </footer>
    </div>

    <!-- éŸ³é¢‘ -->
    <audio id="bgMusic" loop>
        <source src="https://assets.mixkit.co/music/preview/mixkit-christmas-is-here-186.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ==================== å…¨å±€å˜é‡ä¸é…ç½® ====================
        const CONFIG = {
            LIGHT_COLORS: [
                '#FF0000', '#00FF00', '#FFFF00', '#00FFFF', 
                '#FF00FF', '#FFA500', '#FF69B4', '#9370DB',
                '#00FF7F', '#1E90FF', '#FFD700', '#FF1493'
            ],
            TREE_STYLES: ['classic', 'rainbow', 'ice', 'fire', 'galaxy'],
            WISHES: [
                {text: "æ„¿ä½ å¿ƒæƒ³äº‹æˆï¼Œç¾æ¢¦æˆçœŸ âœ¨", author: "æ˜Ÿç©ºè®¸æ„¿ç²¾çµ"},
                {text: "å¹³å®‰å–œä¹å¸¸ç›¸ä¼´ï¼Œå²æœˆé™å¥½æ°¸ç›¸éš â¤ï¸", author: "å¹³å®‰ä½¿è€…"},
                {text: "ä»£ç æ— BUGï¼Œäººç”Ÿçš†å¦é€” ğŸ’»", author: "ç¨‹åºå‘˜åœ£è¯è€äºº"},
                {text: "æ„¿ä½ çš„ä¸–ç•Œï¼Œæ°¸è¿œé—ªçƒæ¸©æš–çš„å…‰èŠ’ ğŸŒŸ", author: "å…‰èŠ’å®ˆæŠ¤è€…"},
                {text: "åœ£è¯é’Ÿå£°å“èµ·ï¼Œå¹¸ç¦æ­£åœ¨æ´¾é€ä¸­ ğŸ””", author: "é’Ÿå£°é‚®å·®"},
                {text: "é›ªèŠ±é£˜è½æ—¶ï¼Œæ‰€æœ‰çš„ç¾å¥½éƒ½å°†å¦‚æœŸè€Œè‡³ â„ï¸", author: "é›ªèŠ±ä»™å­"},
                {text: "çˆ±æ˜¯åœ£è¯æœ€å¥½çš„ç¤¼ç‰©ï¼Œä½ æ˜¯æˆ‘æœ€æƒ³çš„ç¥ç¦ ğŸ", author: "çˆ±å¿ƒå¤§ä½¿"},
                {text: "æ„¿æ–°å¹´èƒœæ—§å¹´ï¼Œæœªæ¥çš†å¯æœŸ ğŸ‰", author: "æ—¶å…‰æ—…äºº"}
            ]
        };

        // çŠ¶æ€ç®¡ç†
        let state = {
            visitCount: parseInt(localStorage.getItem('xmasVisitCount')) || 1,
            lightCount: 128,
            wishCount: 1,
            heartCount: 0,
            currentStyle: 'classic',
            lightsOn: true,
            snowActive: true,
            musicPlaying: false,
            currentWishIndex: 0
        };

        // DOMå…ƒç´ 
        const canvas = document.getElementById('treeCanvas');
        const ctx = canvas.getContext('2d');

        // ==================== åˆå§‹åŒ–å‡½æ•° ====================
        function init() {
            // æ›´æ–°è®¿é—®æ•°æ®
            state.visitCount++;
            localStorage.setItem('xmasVisitCount', state.visitCount);
            updateStatsDisplay();
            
            // åˆ›å»ºèƒŒæ™¯æ˜Ÿå…‰
            createStars();
            
            // ç»˜åˆ¶åˆå§‹åœ£è¯æ ‘
            drawChristmasTree();
            
            // åˆå§‹åŒ–ç¥ç¦
            changeWish();
            
            // å¯åŠ¨é›ªèŠ±
            if (state.snowActive) createSnowfall();
            
            // å¯åŠ¨ç¯å…‰è‡ªåŠ¨å˜æ¢
            setInterval(() => {
                if (state.lightsOn) {
                    state.lightCount += 3;
                    drawChristmasTree();
                    updateStatsDisplay();
                }
            }, 300);
            
            // è‡ªåŠ¨æ›´æ¢ç¥ç¦ï¼ˆæ¯8ç§’ï¼‰
            setInterval(changeWish, 8000);
            
            // å¶å°”è‡ªåŠ¨å‘å°„çˆ±å¿ƒ
            setInterval(() => {
                if (Math.random() > 0.7) launchHearts(1);
            }, 5000);
            
            console.log('ğŸ„ ç»ˆæç‚«å…‰åœ£è¯æ ‘å·²åŠ è½½ï¼');
        }

        // ==================== æ ¸å¿ƒç»˜å›¾å‡½æ•° ====================
        function drawChristmasTree() {
            const width = canvas.width;
            const height = canvas.height;
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);
            
            // ç»˜åˆ¶æ ‘çš„ä¸»ä½“
            drawTreeBody(width, height);
            
            // ç»˜åˆ¶è£…é¥°å’Œç¯å…‰
            drawDecorations(width, height);
            
            // ç»˜åˆ¶æ ‘é¡¶æ˜Ÿæ˜Ÿ
            drawStar(width, height);
            
            // ç»˜åˆ¶æ ‘å¹²
            drawTrunk(width, height);
        }

        function drawTreeBody(width, height) {
            const centerX = width / 2;
            const treeBottom = height - 80;
            const treeTop = 100;
            const treeHeight = treeBottom - treeTop;
            
            // æ ¹æ®æ ·å¼é€‰æ‹©é¢œè‰²
            let gradient;
            switch(state.currentStyle) {
                case 'rainbow':
                    gradient = ctx.createLinearGradient(centerX - 150, treeTop, centerX + 150, treeBottom);
                    gradient.addColorStop(0, '#FF0000');
                    gradient.addColorStop(0.2, '#FFA500');
                    gradient.addColorStop(0.4, '#FFFF00');
                    gradient.addColorStop(0.6, '#00FF00');
                    gradient.addColorStop(0.8, '#00FFFF');
                    gradient.addColorStop(1, '#FF00FF');
                    break;
                case 'ice':
                    gradient = ctx.createLinearGradient(centerX - 150, treeTop, centerX + 150, treeBottom);
                    gradient.addColorStop(0, '#E0FFFF');
                    gradient.addColorStop(0.5, '#AFEEEE');
                    gradient.addColorStop(1, '#00CED1');
                    break;
                case 'fire':
                    gradient = ctx.createLinearGradient(centerX - 150, treeTop, centerX + 150, treeBottom);
                    gradient.addColorStop(0, '#FF4500');
                    gradient.addColorStop(0.5, '#FF8C00');
                    gradient.addColorStop(1, '#FFD700');
                    break;
                case 'galaxy':
                    gradient = ctx.createLinearGradient(centerX - 150, treeTop, centerX + 150, treeBottom);
                    gradient.addColorStop(0, '#9370DB');
                    gradient.addColorStop(0.5, '#8A2BE2');
                    gradient.addColorStop(1, '#4B0082');
                    break;
                default: // classic
                    gradient = ctx.createLinearGradient(centerX - 150, treeTop, centerX + 150, treeBottom);
                    gradient.addColorStop(0, '#228B22');
                    gradient.addColorStop(1, '#32CD32');
            }
            
            // ç»˜åˆ¶æ ‘å±‚
            const layers = 8;
            for (let i = 0; i < layers; i++) {
                const layerY = treeTop + (i * (treeHeight / layers));
                const layerWidth = 80 + (i * 30);
                
                ctx.beginPath();
                ctx.moveTo(centerX - layerWidth/2, layerY);
                ctx.lineTo(centerX, layerY - 40);
                ctx.lineTo(centerX + layerWidth/2, layerY);
                ctx.closePath();
                
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // æ·»åŠ å›¾å±‚è¾¹ç¼˜é«˜å…‰
                ctx.strokeStyle = 'rgba(255, 255, 200, 0.3)';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        }

        function drawDecorations(width, height) {
            if (!state.lightsOn) return;
            
            const centerX = width / 2;
            const treeTop = 100;
            const treeBottom = height - 80;
            
            // ç»˜åˆ¶é—ªçƒçš„è£…é¥°ç¯
            for (let i = 0; i < 25; i++) {
                const x = centerX + (Math.random() - 0.5) * 200;
                const y = treeTop + Math.random() * (treeBottom - treeTop - 100);
                
                // éšæœºé¢œè‰²å’Œå¤§å°
                const color = CONFIG.LIGHT_COLORS[Math.floor(Math.random() * CONFIG.LIGHT_COLORS.length)];
                const size = 4 + Math.random() * 6;
                const pulse = Math.sin(Date.now() / 200 + i) * 0.3 + 0.7;
                
                // ç»˜åˆ¶å…‰æ™•
                const gradient = ctx.createRadialGradient(x, y, 0, x, y, size * 3);
                gradient.addColorStop(0, color);
                gradient.addColorStop(1, 'transparent');
                
                ctx.beginPath();
                ctx.arc(x, y, size * 3 * pulse, 0, Math.PI * 2);
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // ç»˜åˆ¶ç¯çƒ
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fillStyle = color;
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 1;
                ctx.stroke();
            }
        }

        function drawStar(width, height) {
            const centerX = width / 2;
            const starY = 70;
            
            ctx.save();
            ctx.translate(centerX, starY);
            
            // æ—‹è½¬åŠ¨ç”»
            const rotation = (Date.now() / 1000) % (Math.PI * 2);
            ctx.rotate(rotation);
            
            // ç»˜åˆ¶æ˜Ÿæ˜Ÿ
            ctx.beginPath();
            for (let i = 0; i < 5; i++) {
                const angle = (i * 2 * Math.PI / 5) - Math.PI / 2;
                const radius1 = 25;
                const radius2 = 10;
                
                const x1 = Math.cos(angle) * radius1;
                const y1 = Math.sin(angle) * radius1;
                
                const angle2 = angle + Math.PI / 5;
                const x2 = Math.cos(angle2) * radius2;
                const y2 = Math.sin(angle2) * radius2;
                
                if (i === 0) {
                    ctx.moveTo(x1, y1);
                } else {
                    ctx.lineTo(x1, y1);
                }
                ctx.lineTo(x2, y2);
            }
            ctx.closePath();
            
            // æ˜Ÿæ˜Ÿæ¸å˜
            const starGradient = ctx.createRadialGradient(0, 0, 0, 0, 0, 30);
            starGradient.addColorStop(0, '#FFFFFF');
            starGradient.addColorStop(1, '#FFD700');
            
            ctx.fillStyle = starGradient;
            ctx.fill();
            ctx.strokeStyle = '#FFA500';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // æ˜Ÿå…‰
            for (let i = 0; i < 8; i++) {
                const angle = (i * Math.PI / 4);
                const length = 40 + Math.sin(Date.now() / 300 + i) * 10;
                
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(Math.cos(angle) * length, Math.sin(angle) * length);
                
                const lineGradient = ctx.createLinearGradient(0, 0, 
                    Math.cos(angle) * length, Math.sin(angle) * length);
                lineGradient.addColorStop(0, 'rgba(255, 255, 255, 0.8)');
                lineGradient.addColorStop(1, 'transparent');
                
                ctx.strokeStyle = lineGradient;
                ctx.lineWidth = 3;
                ctx.stroke();
            }
            
            ctx.restore();
        }

        function drawTrunk(width, height) {
            const centerX = width / 2;
            const trunkTop = height - 80;
            const trunkHeight = 60;
            const trunkWidth = 30;
            
            // æ ‘å¹²
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(centerX - trunkWidth/2, trunkTop, trunkWidth, trunkHeight);
            
            // æ ‘å¹²çº¹ç†
            ctx.strokeStyle = '#A0522D';
            ctx.lineWidth = 2;
            for (let i = 0; i < 5; i++) {
                const y = trunkTop + 10 + i * 10;
                ctx.beginPath();
                ctx.moveTo(centerX - trunkWidth/2 + 5, y);
                ctx.lineTo(centerX + trunkWidth/2 - 5, y);
                ctx.stroke();
            }
            
            // æ ‘ä¸‹é˜´å½±
            const shadowGradient = ctx.createRadialGradient(
                centerX, trunkTop + trunkHeight, 0,
                centerX, trunkTop + trunkHeight, 80
            );
            shadowGradient.addColorStop(0, 'rgba(0, 0, 0, 0.3)');
            shadowGradient.addColorStop(1, 'transparent');
            
            ctx.fillStyle = shadowGradient;
            ctx.fillRect(centerX - 80, trunkTop + trunkHeight - 10, 160, 80);
        }

        // ==================== ç‰¹æ•ˆåŠŸèƒ½å‡½æ•° ====================
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const starCount = 150;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                // éšæœºå±æ€§
                const size = 1 + Math.random() * 3;
                const x = Math.random() * 100;
                const y = Math.random() * 100;
                const duration = 2 + Math.random() * 4;
                const delay = Math.random() * 5;
                
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${x}vw`;
                star.style.top = `${y}vh`;
                star.style.setProperty('--duration', `${duration}s`);
                star.style.animationDelay = `${delay}s`;
                
                starsContainer.appendChild(star);
            }
        }

        function createSnowfall() {
            if (!state.snowActive) return;
            
            const snowflakeCount = 50;
            const snowflakes = ['â„ï¸', 'âœ¨', 'â…', 'â†'];
            
            for (let i = 0; i < snowflakeCount; i++) {
                setTimeout(() => {
                    createSnowflake();
                }, i * 200);
            }
            
            // æŒç»­ç”Ÿæˆ
            setInterval(() => {
                if (state.snowActive && Math.random() > 0.3) {
                    createSnowflake();
                }
            }, 500);
        }

        function createSnowflake() {
            const snowflake = document.createElement('div');
            snowflake.className = 'snowflake';
            snowflake.innerHTML = ['â„ï¸', 'âœ¨', 'â…', 'â†'][Math.floor(Math.random() * 4)];
            
            // éšæœºå±æ€§
            const size = 15 + Math.random() * 25;
            const left = Math.random() * 100;
            const duration = 5 + Math.random() * 10;
            const delay = Math.random() * 5;
            
            snowflake.style.fontSize = `${size}px`;
            snowflake.style.left = `${left}vw`;
            snowflake.style.opacity = 0.5 + Math.random() * 0.5;
            snowflake.style.animationDuration = `${duration}s`;
            snowflake.style.animationDelay = `${delay}s`;
            
            document.body.appendChild(snowflake);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤
            setTimeout(() => {
                if (snowflake.parentNode) {
                    snowflake.parentNode.removeChild(snowflake);
                }
            }, (duration + 2) * 1000);
        }

        function launchHearts(count = 15) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    createHeart();
                }, i * 100);
            }
            state.heartCount += count;
            updateStatsDisplay();
        }

        function createHeart() {
            const heart = document.createElement('div');
            heart.className = 'heart';
            heart.innerHTML = 'â¤ï¸';
            
            // éšæœºèµ·å§‹ä½ç½®ï¼ˆå±å¹•ä¸‹åŠéƒ¨åˆ†ï¼‰
            const startLeft = 30 + Math.random() * 40;
            const startTop = 60 + Math.random() * 30;
            
            heart.style.left = `${startLeft}%`;
            heart.style.top = `${startTop}%`;
            heart.style.fontSize = `${20 + Math.random() * 30}px`;
            
            // éšæœºåŠ¨ç”»å‚æ•°
            const duration = 1 + Math.random() * 1.5;
            heart.style.animationDuration = `${duration}s`;
            
            document.body.appendChild(heart);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤
            setTimeout(() => {
                if (heart.parentNode) {
                    heart.parentNode.removeChild(heart);
                }
            }, duration * 1000);
        }

        // ==================== äº¤äº’æ§åˆ¶å‡½æ•° ====================
        function toggleLights() {
            state.lightsOn = !state.lightsOn;
            drawChristmasTree();
            
            const btn = document.querySelector('.btn-light .btn-label');
            btn.textContent = state.lightsOn ? 'å…³é—­ç¯å…‰' : 'æ¢¦å¹»ç¯å…‰';
        }

        function changeTreeStyle() {
            const currentIndex = CONFIG.TREE_STYLES.indexOf(state.currentStyle);
            const nextIndex = (currentIndex + 1) % CONFIG.TREE_STYLES.length;
            state.currentStyle = CONFIG.TREE_STYLES[nextIndex];
            
            drawChristmasTree();
            
            // æ›´æ–°æŒ‰é’®æ–‡å­—
            const styleNames = {
                'classic': 'ç»å…¸ç»¿', 
                'rainbow': 'å½©è™¹', 
                'ice': 'å†°é›ª', 
                'fire': 'ç«ç„°', 
                'galaxy': 'æ˜Ÿç©º'
            };
            document.querySelector('.btn-style .btn-label').textContent = 
                styleNames[state.currentStyle];
        }

        function changeWish() {
            state.currentWishIndex = (state.currentWishIndex + 1) % CONFIG.WISHES.length;
            const wish = CONFIG.WISHES[state.currentWishIndex];
            
            document.getElementById('wishText').textContent = wish.text;
            document.getElementById('wishAuthor').textContent = wish.author;
            
            state.wishCount++;
            updateStatsDisplay();
            
            // æ·»åŠ æ–‡å­—åŠ¨ç”»æ•ˆæœ
            const wishText = document.getElementById('wishText');
            wishText.style.animation = 'none';
            setTimeout(() => {
                wishText.style.animation = 'fadeIn 0.8s ease';
            }, 10);
        }

        function toggleSnow() {
            state.snowActive = !state.snowActive;
            
            const btn = document.querySelector('.btn-snow .btn-label');
            btn.textContent = state.snowActive ? 'å…³é—­é›ªèŠ±' : 'å†°é›ªä¸–ç•Œ';
            
            if (!state.snowActive) {
                // ç§»é™¤æ‰€æœ‰é›ªèŠ±
                document.querySelectorAll('.snowflake').forEach(snow => {
                    if (snow.parentNode) snow.parentNode.removeChild(snow);
                });
            } else {
                createSnowfall();
            }
        }

        function toggleMusic() {
            const music = document.getElementById('bgMusic');
            state.musicPlaying = !state.musicPlaying;
            
            if (state.musicPlaying) {
                music.play().catch(e => {
                    console.log('éŸ³ä¹æ’­æ”¾å¤±è´¥:', e);
                    state.musicPlaying = false;
                });
            } else {
                music.pause();
            }
            
            const btn = document.querySelector('.btn-music .btn-label');
            btn.textContent = state.musicPlaying ? 'å…³é—­éŸ³ä¹' : 'èŠ‚æ—¥éŸ³ä¹';
        }

        function shareTree() {
            const url = window.location.href;
            const title = 'âœ¨ çœ‹çœ‹æˆ‘çš„ç»ˆæç‚«å…‰åœ£è¯æ ‘ï¼';
            const text = 'æˆ‘åˆ¶ä½œäº†ä¸€ä¸ªè¶…é…·çš„åŠ¨æ€åœ£è¯æ ‘ï¼Œé—ªçƒçš„ç¯å…‰å’Œç‰¹æ•ˆå¤ªç¾äº†ï¼';
            
            if (navigator.share) {
                navigator.share({ title, text, url })
                    .catch(err => console.log('åˆ†äº«å–æ¶ˆ:', err));
            } else {
                navigator.clipboard.writeText(url).then(() => {
                    alert('é“¾æ¥å·²å¤åˆ¶ï¼ç²˜è´´åˆ†äº«ç»™æœ‹å‹å§ï½');
                });
            }
        }

        function updateStatsDisplay() {
            document.getElementById('visitCount').textContent = state.visitCount;
            document.getElementById('lightCount').textContent = state.lightCount;
            document.getElementById('wishCount').textContent = state.wishCount;
            document.getElementById('heartCount').textContent = state.heartCount;
        }

        // ==================== é¡µé¢åŠ è½½ ====================
        window.addEventListener('load', init);

        // æ§åˆ¶å°å½©è›‹
        console.log(`
        %cğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„
        %cğŸ„                                ğŸ„
        %cğŸ„    ç»ˆæç‚«å…‰åœ£è¯æ ‘åŠ è½½æˆåŠŸ      ğŸ„
        %cğŸ„                                ğŸ„
        %cğŸ„    è¯•è¯•è¿™äº›å¿«æ·é”®ï¼š            ğŸ„
        %cğŸ„    L - åˆ‡æ¢ç¯å…‰               ğŸ„
        %cğŸ„    S - åˆ‡æ¢æ ·å¼               ğŸ„
        %cğŸ„    W - æ›´æ¢ç¥ç¦               ğŸ„
        %cğŸ„    H - å‘å°„çˆ±å¿ƒ               ğŸ„
        %cğŸ„    M - éŸ³ä¹å¼€å…³               ğŸ„
        %cğŸ„                                ğŸ„
        %cğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„
        `, 
        'color: #00ff88',
        'color: #00ff88',
        'color: #ffdd00',
        'color: #00ff88',
        'color: #00ccff',
        'color: #ff9966',
        'color: #9966ff',
        'color: #ff2a6d',
        'color: #ffcc00',
        'color: #00ff88',
        'color: #00ff88'
        );

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            switch(e.key.toLowerCase()) {
                case 'l': toggleLights(); break;
                case 's': changeTreeStyle(); break;
                case 'w': changeWish(); break;
                case 'h': launchHearts(); break;
                case 'm': toggleMusic(); break;
                case ' ': launchHearts(5); break;
            }
        });
    </script>
</body>
</html>
