<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ„ æŠ–éŸ³åŒæ¬¾è¶…æµªæ¼«åœ£è¯æ ‘ ğŸ„</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
            padding: 20px;
            position: relative;
        }

        .snowflake {
            position: absolute;
            color: white;
            font-size: 20px;
            user-select: none;
            pointer-events: none;
            z-index: 1;
            animation: fall linear infinite;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }

        .container {
            max-width: 800px;
            width: 100%;
            text-align: center;
            z-index: 2;
            position: relative;
        }

        .header {
            margin-bottom: 30px;
            animation: fadeIn 1s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            color: #4CAF50;
            font-size: 2.8em;
            margin-bottom: 10px;
            text-shadow: 0 0 15px #4CAF50;
            background: linear-gradient(45deg, #4CAF50, #8BC34A, #CDDC39);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #FFD700;
            font-size: 1.2em;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        .tree-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }

        .tree {
            font-family: 'Courier New', monospace;
            font-size: 22px;
            line-height: 1.4;
            margin: 0 auto;
            color: #32CD32;
            text-shadow: 0 0 10px #32CD32;
            position: relative;
            z-index: 1;
        }

        .light {
            display: inline-block;
            animation: twinkle 1s infinite alternate;
        }

        @keyframes twinkle {
            0% { 
                opacity: 0.3; 
                transform: scale(0.8); 
                filter: brightness(0.8);
            }
            100% { 
                opacity: 1; 
                transform: scale(1.2); 
                filter: brightness(1.5);
            }
        }

        .star {
            color: gold;
            text-shadow: 0 0 20px gold;
            animation: spin 3s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .decoration {
            position: absolute;
            font-size: 24px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
        }

        .btn {
            background: linear-gradient(45deg, #FF5722, #FF9800);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 5px 15px rgba(255, 87, 34, 0.4);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 87, 34, 0.6);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #2196F3, #03A9F4);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }

        .btn-secondary:hover {
            box-shadow: 0 8px 20px rgba(33, 150, 243, 0.6);
        }

        .wish-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
            border-left: 4px solid #4CAF50;
        }

        .wish-text {
            font-size: 1.8em;
            color: #FFD700;
            margin: 10px 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeInOut 4s infinite alternate;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .counter {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            margin: 10px;
            font-size: 0.9em;
        }

        .instructions {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9em;
            color: #aaa;
            border: 1px dashed rgba(255, 255, 255, 0.2);
        }

        .footer {
            margin-top: 30px;
            color: #888;
            font-size: 0.9em;
        }

        .share-btn {
            margin-top: 20px;
            background: linear-gradient(45deg, #9C27B0, #E91E63);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            h1 { font-size: 2em; }
            .tree { font-size: 18px; }
            .btn { padding: 12px 20px; font-size: 14px; }
            .wish-text { font-size: 1.4em; }
            .controls { gap: 10px; }
        }

        @media (max-width: 480px) {
            h1 { font-size: 1.6em; }
            .tree { font-size: 16px; }
            .tree-container { padding: 20px; }
            .controls { flex-direction: column; }
            .btn { width: 100%; justify-content: center; }
        }

        /* çˆ±å¿ƒç‰¹æ•ˆ */
        .heart {
            position: absolute;
            font-size: 24px;
            color: #ff4757;
            pointer-events: none;
            z-index: 1000;
            animation: heartFloat 3s ease-in forwards;
        }

        @keyframes heartFloat {
            0% { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
            100% { 
                opacity: 0; 
                transform: translateY(-100px) scale(1.5); 
            }
        }

        /* è¿›åº¦æ¡ */
        .progress-container {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 4px;
            width: 0%;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <!-- é›ªèŠ±èƒŒæ™¯ -->
    <div id="snowflakes"></div>
    
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-tree"></i> æŠ–éŸ³åŒæ¬¾è¶…æµªæ¼«åœ£è¯æ ‘ <i class="fas fa-tree"></i></h1>
            <div class="subtitle">åˆ†äº«ç»™ä½ çš„TAï¼Œä¸€èµ·æ„Ÿå—åœ£è¯çš„æ¸©æš–ä¸æµªæ¼« â¤ï¸</div>
            <div class="counter">è®¿é—®æ¬¡æ•°: <span id="visitCount">1</span></div>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="tree-container">
            <div class="tree" id="treeDisplay">
                <!-- åœ£è¯æ ‘å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <!-- è£…é¥°ç‰©ä½ç½® -->
            <div id="decorations"></div>
        </div>

        <div class="wish-container">
            <p><i class="fas fa-gift"></i> åœ£è¯ç¥ç¦ï¼š</p>
            <div class="wish-text" id="wishText">æ­£åœ¨åŠ è½½ç¥ç¦...</div>
            <p id="wishAuthor"></p>
        </div>

        <div class="controls">
            <button class="btn" onclick="changeLights()">
                <i class="fas fa-lightbulb"></i> åˆ‡æ¢ç¯å…‰
            </button>
            <button class="btn" onclick="changeTree()">
                <i class="fas fa-palette"></i> æ›´æ¢æ ·å¼
            </button>
            <button class="btn" onclick="changeWish()">
                <i class="fas fa-comment-alt"></i> æ›´æ¢ç¥ç¦
            </button>
            <button class="btn" onclick="toggleSnow()">
                <i class="fas fa-snowflake"></i> é›ªèŠ±ç‰¹æ•ˆ
            </button>
            <button class="btn btn-secondary" onclick="sendLove()">
                <i class="fas fa-heart"></i> å‘å°„çˆ±å¿ƒ
            </button>
            <button class="btn btn-secondary" onclick="shareTree()">
                <i class="fas fa-share-alt"></i> åˆ†äº«ç»™æœ‹å‹
            </button>
        </div>

        <div class="instructions">
            <p><i class="fas fa-info-circle"></i> ä½¿ç”¨æç¤ºï¼š</p>
            <p>1. ç‚¹å‡»æŒ‰é’®ä½“éªŒä¸åŒç‰¹æ•ˆ</p>
            <p>2. é•¿æŒ‰å±å¹•å¯ä»¥ä¿å­˜åœ£è¯æ ‘å›¾ç‰‡</p>
            <p>3. åˆ†äº«ç»™æœ‹å‹ä¸€èµ·æ„Ÿå—åœ£è¯æ°›å›´</p>
            <p>4. æ­¤é¡µé¢å·²é€‚é…æ‰‹æœºï¼Œæ¨ªå±æ•ˆæœæ›´ä½³</p>
        </div>

        <div class="footer">
            <p>ğŸ„ åˆ¶ä½œï¼šæŠ–éŸ³åŒæ¬¾åœ£è¯æ ‘ | ğŸ… ç¥ä½ åœ£è¯å¿«ä¹ï¼</p>
            <p>â¤ï¸ åˆ†äº«çˆ±ï¼Œä¼ é€’æ¸©æš–ï¼Œè®©è¿™ä¸ªåœ£è¯èŠ‚æ›´æœ‰æ„ä¹‰</p>
            <button class="btn share-btn" onclick="copyLink()">
                <i class="fas fa-link"></i> å¤åˆ¶åˆ†äº«é“¾æ¥
            </button>
        </div>
    </div>

    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="bgMusic" loop>
        <!-- å¯ä»¥ä½¿ç”¨åœ¨çº¿éŸ³ä¹é“¾æ¥ï¼Œè¿™é‡Œä½¿ç”¨é™éŸ³å ä½ -->
        <source src="" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
    </audio>

    <script>
        // ==================== åˆå§‹åŒ–æ•°æ® ====================
        const treeDesigns = [
            // è®¾è®¡1ï¼šç»å…¸åœ£è¯æ ‘
            [
                "         â˜…",
                "        ğŸ„ğŸ„ğŸ„",
                "       ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„",
                "      ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„",
                "     ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„",
                "    ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„",
                "   ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„",
                "  ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„",
                " ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„",
                "ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„",
                "        |||",
                "        |||"
            ],
            // è®¾è®¡2ï¼šç®€çº¦é£æ ¼
            [
                "         â˜†",
                "        âœ¨âœ¨âœ¨",
                "       âœ¨âœ¨âœ¨âœ¨âœ¨",
                "      âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨",
                "     âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨",
                "    âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨",
                "   âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨",
                "  âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨âœ¨",
                "        â–ˆâ–ˆâ–ˆ",
                "        â–ˆâ–ˆâ–ˆ"
            ],
            // è®¾è®¡3ï¼šçˆ±å¿ƒæ ‘
            [
                "         â™¥",
                "        â™¥â™¥â™¥",
                "       â™¥â™¥â™¥â™¥â™¥",
                "      â™¥â™¥â™¥â™¥â™¥â™¥â™¥",
                "     â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥",
                "    â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥",
                "   â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥",
                "  â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥â™¥",
                "        |||",
                "        |||"
            ]
        ];

        // ç¯å…‰é¢œè‰²ï¼ˆç”¨äºè£…é¥°ï¼‰
        const lightColors = [
            '#FF0000', '#00FF00', '#FFFF00', '#00FFFF', 
            '#FF00FF', '#FFA500', '#FF69B4', '#9370DB',
            '#00FF7F', '#1E90FF', '#FFD700', '#FF1493'
        ];

        // æ ‘ä½“é¢œè‰²
        const treeColors = [
            '#32CD32', '#228B22', '#90EE90', '#98FB98',
            '#00FA9A', '#00FF7F', '#3CB371', '#2E8B57'
        ];

        // åœ£è¯ç¥ç¦è¯­åº“
        const christmasWishes = [
            {text: "åœ£è¯å¿«ä¹ï¼æ„¿ä½ çš„ä¸–ç•Œå……æ»¡çˆ±ä¸æ¸©æš– â¤ï¸", author: "åœ£è¯è€äºº"},
            {text: "æ„¿ä½ å¿ƒæƒ³äº‹æˆï¼Œç¾æ¢¦æˆçœŸ âœ¨", author: "å°ç²¾çµ"},
            {text: "å¹³å®‰å¤œçš„é’Ÿå£°ï¼Œä¸ºä½ æ•²å“å¹¸ç¦ä¹‹é—¨ ğŸ””", author: "å¹³å®‰ä½¿è€…"},
            {text: "æ„¿åœ£è¯çš„å–œæ‚¦ä¼´ä½ ä¸€æ•´å¹´ ğŸ", author: "å¿«ä¹å¤©ä½¿"},
            {text: "é›ªèŠ±é£˜è½ï¼Œç¥ç¦é€åˆ°ï¼Œåœ£è¯å¿«ä¹ï¼ â„ï¸", author: "é›ªèŠ±ä»™å­"},
            {text: "æ„¿ä½ çš„åœ£è¯å……æ»¡ç¥å¥‡ä¸ç¾å¥½ ğŸ¦Œ", author: "é©¯é¹¿é²é“å¤«"},
            {text: "å’Œå®¶äººå…±åº¦æ¸©é¦¨åœ£è¯æ—¶å…‰ ğŸ ", author: "å®¶åº­å®ˆæŠ¤è€…"},
            {text: "çˆ±æ˜¯åœ£è¯æœ€å¥½çš„ç¤¼ç‰©ï¼Œæ„¿çˆ±å¸¸ä¼´ä½ å·¦å³ ğŸ’", author: "çˆ±å¿ƒä½¿è€…"},
            {text: "åœ£è¯æ ‘ä¸ŠæŒ‚æ»¡ç¥ç¦ï¼Œæ¯ä¸€ä¸ªéƒ½æ˜¯ç»™ä½ çš„ ğŸ„", author: "åœ£è¯æ ‘ç²¾çµ"},
            {text: "æ„¿æ–°å¹´çš„å¸Œæœ›ä»ä»Šå¤œå¼€å§‹ ğŸŒŸ", author: "å¸Œæœ›ä¹‹æ˜Ÿ"}
        ];

        // è£…é¥°ç‰©ç¬¦å·
        const decorations = ['ğŸ', 'ğŸ””', 'â­', 'âœ¨', 'â„ï¸', 'ğŸ¬', 'ğŸ€', 'ğŸ§¦'];

        // ==================== å…¨å±€å˜é‡ ====================
        let currentTreeIndex = 0;
        let currentLightIndex = 0;
        let currentWishIndex = 0;
        let snowEnabled = true;
        let lightsEnabled = true;
        let decorationInterval;
        let visitCount = localStorage.getItem('christmasVisitCount') || 1;
        let autoChangeInterval;

        // ==================== åˆå§‹åŒ–å‡½æ•° ====================
        function init() {
            // æ›´æ–°è®¿é—®æ¬¡æ•°
            document.getElementById('visitCount').textContent = visitCount;
            localStorage.setItem('christmasVisitCount', parseInt(visitCount) + 1);
            
            // åˆå§‹ç»˜åˆ¶
            drawTree();
            addDecorations();
            changeWish();
            createSnowflakes();
            
            // è‡ªåŠ¨åˆ‡æ¢æ•ˆæœ
            startAutoChanges();
            
            // åˆå§‹åŒ–è¿›åº¦æ¡
            initProgressBar();
            
            // æ·»åŠ é¡µé¢åŠ è½½å®ŒæˆåŠ¨ç”»
            setTimeout(() => {
                document.querySelector('.tree-container').style.transform = 'scale(1)';
                document.querySelector('.tree-container').style.opacity = '1';
            }, 100);
            
            console.log("ğŸ„ åœ£è¯æ ‘åˆå§‹åŒ–å®Œæˆï¼");
        }

        // ==================== åœ£è¯æ ‘ç»˜åˆ¶å‡½æ•° ====================
        function drawTree() {
            const treeDisplay = document.getElementById('treeDisplay');
            treeDisplay.innerHTML = '';
            
            const currentTree = treeDesigns[currentTreeIndex];
            
            currentTree.forEach((line, lineIndex) => {
                const lineDiv = document.createElement('div');
                let lineHTML = '';
                
                for (let char of line) {
                    if (char === 'ğŸ„' || char === 'âœ¨' || char === 'â™¥') {
                        // å¯¹æ ‘éƒ¨åˆ†æ·»åŠ é—ªçƒæ•ˆæœ
                        if (lightsEnabled) {
                            const color = lightColors[currentLightIndex % lightColors.length];
                            lineHTML += `<span class="light" style="color:${color}; animation-delay:${Math.random()}s">${char}</span>`;
                        } else {
                            lineHTML += `<span style="color:${treeColors[currentTreeIndex % treeColors.length]}">${char}</span>`;
                        }
                    } else if (char === 'â˜…' || char === 'â˜†') {
                        // æ˜Ÿæ˜Ÿç‰¹æ•ˆ
                        lineHTML += `<span class="star">${char}</span>`;
                    } else {
                        lineHTML += char;
                    }
                }
                
                lineDiv.innerHTML = lineHTML;
                treeDisplay.appendChild(lineDiv);
            });
            
            // æ›´æ–°è¿›åº¦æ¡
            updateProgressBar(30);
        }

        // ==================== è£…é¥°ç‰©æ·»åŠ å‡½æ•° ====================
        function addDecorations() {
            const decorationsContainer = document.getElementById('decorations');
            decorationsContainer.innerHTML = '';
            
            // ä¸ºåœ£è¯æ ‘æ·»åŠ éšæœºè£…é¥°ç‰©
            for (let i = 0; i < 12; i++) {
                const decoration = document.createElement('div');
                decoration.className = 'decoration';
                decoration.textContent = decorations[Math.floor(Math.random() * decorations.length)];
                
                // éšæœºä½ç½®
                const left = 30 + Math.random() * 40;
                const top = 20 + Math.random() * 70;
                
                decoration.style.left = `${left}%`;
                decoration.style.top = `${top}%`;
                decoration.style.animationDelay = `${Math.random() * 2}s`;
                decoration.style.color = lightColors[Math.floor(Math.random() * lightColors.length)];
                
                decorationsContainer.appendChild(decoration);
            }
            
            // æ›´æ–°è¿›åº¦æ¡
            updateProgressBar(50);
        }

        // ==================== é›ªèŠ±ç‰¹æ•ˆå‡½æ•° ====================
        function createSnowflakes() {
            if (!snowEnabled) return;
            
            const snowContainer = document.getElementById('snowflakes');
            const snowflakeCount = 50;
            
            for (let i = 0; i < snowflakeCount; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.innerHTML = 'â„ï¸';
                
                // éšæœºå±æ€§
                const size = 10 + Math.random() * 20;
                const left = Math.random() * 100;
                const duration = 5 + Math.random() * 10;
                const delay = Math.random() * 5;
                
                snowflake.style.fontSize = `${size}px`;
                snowflake.style.left = `${left}vw`;
                snowflake.style.opacity = 0.3 + Math.random() * 0.7;
                snowflake.style.animationDuration = `${duration}s`;
                snowflake.style.animationDelay = `${delay}s`;
                
                snowContainer.appendChild(snowflake);
                
                // é›ªèŠ±æ¶ˆå¤±åé‡æ–°åˆ›å»º
                setTimeout(() => {
                    if (snowflake.parentNode && snowEnabled) {
                        snowflake.parentNode.removeChild(snowflake);
                        if (snowEnabled) createSingleSnowflake();
                    }
                }, (duration + delay) * 1000);
            }
            
            // æ›´æ–°è¿›åº¦æ¡
            updateProgressBar(70);
        }

        function createSingleSnowflake() {
            if (!snowEnabled) return;
            
            const snowContainer = document.getElementById('snowflakes');
            const snowflake = document.createElement('div');
            snowflake.className = 'snowflake';
            snowflake.innerHTML = 'â„ï¸';
            
            const size = 10 + Math.random() * 20;
            const left = Math.random() * 100;
            const duration = 5 + Math.random() * 10;
            
            snowflake.style.fontSize = `${size}px`;
            snowflake.style.left = `${left}vw`;
            snowflake.style.opacity = 0.3 + Math.random() * 0.7;
            snowflake.style.animationDuration = `${duration}s`;
            
            snowContainer.appendChild(snowflake);
            
            setTimeout(() => {
                if (snowflake.parentNode) {
                    snowflake.parentNode.removeChild(snowflake);
                    if (snowEnabled) createSingleSnowflake();
                }
            }, duration * 1000);
        }

        function toggleSnow() {
            snowEnabled = !snowEnabled;
            const snowBtn = document.querySelector('button[onclick="toggleSnow()"]');
            
            if (snowEnabled) {
                snowBtn.innerHTML = '<i class="fas fa-snowflake"></i> å…³é—­é›ªèŠ±';
                createSnowflakes();
            } else {
                snowBtn.innerHTML = '<i class="fas fa-snowflake"></i> é›ªèŠ±ç‰¹æ•ˆ';
                document.getElementById('snowflakes').innerHTML = '';
            }
        }

        // ==================== äº¤äº’æ§åˆ¶å‡½æ•° ====================
        function changeLights() {
            lightsEnabled = !lightsEnabled;
            currentLightIndex++;
            drawTree();
            
            const lightBtn = document.querySelector('button[onclick="changeLights()"]');
            lightBtn.innerHTML = lightsEnabled ? 
                '<i class="fas fa-lightbulb"></i> å…³é—­ç¯å…‰' : 
                '<i class="fas fa-lightbulb"></i> åˆ‡æ¢ç¯å…‰';
        }

        function changeTree() {
            currentTreeIndex = (currentTreeIndex + 1) % treeDesigns.length;
            drawTree();
            addDecorations();
            updateProgressBar(100);
        }

        function changeWish() {
            currentWishIndex = (currentWishIndex + 1) % christmasWishes.length;
            const wish = christmasWishes[currentWishIndex];
            
            document.getElementById('wishText').textContent = wish.text;
            document.getElementById('wishAuthor').textContent = `â€”â€” ${wish.author}`;
            
            // æ·»åŠ ç¥ç¦è¯­åˆ‡æ¢åŠ¨ç”»
            const wishText = document.getElementById('wishText');
            wishText.style.animation = 'none';
            setTimeout(() => {
                wishText.style.animation = 'fadeInOut 4s infinite alternate';
            }, 10);
        }

        function sendLove() {
            // åˆ›å»ºçˆ±å¿ƒç‰¹æ•ˆ
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    createHeart();
                }, i * 100);
            }
        }

        function createHeart() {
            const heart = document.createElement('div');
            heart.className = 'heart';
            heart.innerHTML = 'â¤ï¸';
            
            const startLeft = 40 + Math.random() * 20;
            
            heart.style.left = `${startLeft}%`;
            heart.style.bottom = '20%';
            heart.style.fontSize = `${20 + Math.random() * 20}px`;
            heart.style.animationDuration = `${1 + Math.random() * 2}s`;
            
            document.body.appendChild(heart);
            
            setTimeout(() => {
                if (heart.parentNode) {
                    heart.parentNode.removeChild(heart);
                }
            }, 3000);
        }

        // ==================== åˆ†äº«åŠŸèƒ½ ====================
        function shareTree() {
            if (navigator.share) {
                navigator.share({
                    title: 'æŠ–éŸ³åŒæ¬¾è¶…æµªæ¼«åœ£è¯æ ‘',
                    text: 'çœ‹æˆ‘åˆ¶ä½œçš„åŠ¨æ€åœ£è¯æ ‘ï¼Œè¶…çº§æµªæ¼«ï¼',
                    url: window.location.href
                })
                .then(() => console.log('åˆ†äº«æˆåŠŸ'))
                .catch(error => console.log('åˆ†äº«å¤±è´¥:', error));
            } else {
                copyLink();
                alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼ç²˜è´´åˆ†äº«ç»™æœ‹å‹å§~');
            }
        }

        function copyLink() {
            const url = window.location.href;
            navigator.clipboard.writeText(url)
                .then(() => {
                    const shareBtn = document.querySelector('button[onclick="copyLink()"]');
                    const originalText = shareBtn.innerHTML;
                    shareBtn.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶ï¼';
                    
                    setTimeout(() => {
                        shareBtn.innerHTML = originalText;
                    }, 2000);
                })
                .catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥');
                });
        }

        // ==================== è‡ªåŠ¨åˆ‡æ¢æ•ˆæœ ====================
        function startAutoChanges() {
            // è‡ªåŠ¨åˆ‡æ¢ç¯å…‰é¢œè‰²
            if (autoChangeInterval) clearInterval(autoChangeInterval);
            
            autoChangeInterval = setInterval(() => {
                if (lightsEnabled) {
                    currentLightIndex++;
                    drawTree();
                }
                
                // éšæœºç§»åŠ¨è£…é¥°ç‰©
                moveDecorationsRandomly();
                
            }, 1500);
        }

        function moveDecorationsRandomly() {
            const allDecorations = document.querySelectorAll('.decoration');
            allDecorations.forEach(deco => {
                const moveX = (Math.random() - 0.5) * 10;
                const moveY = (Math.random() - 0.5) * 10;
                
                const currentLeft = parseFloat(deco.style.left);
                const currentTop = parseFloat(deco.style.top);
                
                let newLeft = currentLeft + moveX;
                let newTop = currentTop + moveY;
                
                // é™åˆ¶åœ¨æ ‘åŒºåŸŸå†…
                newLeft = Math.max(25, Math.min(75, newLeft));
                newTop = Math.max(15, Math.min(85, newTop));
                
                deco.style.left = `${newLeft}%`;
                deco.style.top = `${newTop}%`;
            });
        }

        // ==================== è¿›åº¦æ¡åŠŸèƒ½ ====================
        function initProgressBar() {
            updateProgressBar(10);
        }

        function updateProgressBar(percent) {
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = `${percent}%`;
            
            // æ ¹æ®ç™¾åˆ†æ¯”æ”¹å˜é¢œè‰²
            if (percent < 30) {
                progressBar.style.background = 'linear-gradient(90deg, #FF5722, #FF9800)';
            } else if (percent < 70) {
                progressBar.style.background = 'linear-gradient(90deg, #FF9800, #FFEB3B)';
            } else {
                progressBar.style.background = 'linear-gradient(90deg, #4CAF50, #8BC34A)';
            }
        }

        // ==================== é¡µé¢äº‹ä»¶ç›‘å¬ ====================
        // è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯å‹å¥½ï¼‰
        document.addEventListener('touchstart', function(e) {
            // æ·»åŠ è§¦æ‘¸åé¦ˆ
            if (e.target.tagName === 'BUTTON') {
                e.target.style.transform = 'scale(0.95)';
            }
            
            // é•¿æŒ‰ä¿å­˜
            if (e.target.closest('.tree-container')) {
                setTimeout(() => {
                    // è¿™é‡Œå¯ä»¥æ·»åŠ é•¿æŒ‰ä¿å­˜å›¾ç‰‡åŠŸèƒ½
                }, 1000);
            }
        });

        document.addEventListener('touchend', function(e) {
            if (e.target.tagName === 'BUTTON') {
                e.target.style.transform = '';
            }
        });

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            switch(e.key) {
                case 'ArrowRight':
                case 'd':
                    changeTree();
                    break;
                case 'ArrowLeft':
                case 'a':
                    currentTreeIndex = (currentTreeIndex - 1 + treeDesigns.length) % treeDesigns.length;
                    drawTree();
                    addDecorations();
                    break;
                case ' ':
                case 'Enter':
                    changeWish();
                    break;
                case 's':
                    toggleSnow();
                    break;
                case 'l':
                    changeLights();
                    break;
                case 'h':
                    sendLove();
                    break;
            }
        });

        // é¡µé¢å¯è§æ€§å˜åŒ–
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                if (autoChangeInterval) clearInterval(autoChangeInterval);
            } else {
                startAutoChanges();
            }
        });

        // ==================== é¡µé¢åŠ è½½å®Œæˆ ====================
        // ç­‰å¾…æ‰€æœ‰èµ„æºåŠ è½½
        window.addEventListener('load', function() {
            // æ¨¡æ‹ŸåŠ è½½è¿‡ç¨‹
            let loadPercent = 0;
            const loadInterval = setInterval(() => {
                loadPercent += 10;
                updateProgressBar(loadPercent);
                
                if (loadPercent >= 100) {
                    clearInterval(loadInterval);
                    setTimeout(init, 300);
                }
            }, 100);
        });

        // åˆå§‹åŒ–æç¤º
        console.log(`
        ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„
        ğŸ„                                ğŸ„
        ğŸ„    æŠ–éŸ³åŒæ¬¾åœ£è¯æ ‘å·²åŠ è½½        ğŸ„
        ğŸ„                                ğŸ„
        ğŸ„    ä½¿ç”¨æç¤ºï¼š                  ğŸ„
        ğŸ„    1. ç‚¹å‡»æŒ‰é’®åˆ‡æ¢æ•ˆæœ         ğŸ„
        ğŸ„    2. é”®ç›˜å¿«æ·é”®ï¼š             ğŸ„
        ğŸ„       A/D - åˆ‡æ¢æ ·å¼           ğŸ„
        ğŸ„       ç©ºæ ¼ - æ›´æ¢ç¥ç¦          ğŸ„
        ğŸ„       S - é›ªèŠ±ç‰¹æ•ˆ             ğŸ„
        ğŸ„       L - ç¯å…‰å¼€å…³             ğŸ„
        ğŸ„       H - å‘å°„çˆ±å¿ƒ             ğŸ„
        ğŸ„                                ğŸ„
        ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„ğŸ„
        `);
    </script>
</body>
</html>
